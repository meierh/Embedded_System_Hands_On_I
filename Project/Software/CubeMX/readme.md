# SmartEggTimer - Software for Custom PCB

This program code is supposed to run on our custom PCB.

## Important

> The `CMakeLists.txt` file generated by CubeMX had to be modified. After regeneration of the initialisation code using CubeMX, take care not to commit any unwanted changes to `CMakeLists.txt`!

## Project Structure

- **Core**: Contains the initialisation code generated by CubeMX and the main() function
- **Drivers**: Contains the CMSIS and HAL drivers for our Cortex-M1 chip
- **Peripheral**: Contains low-level code to let our microcontroller interact with all the components on or attached to our board, such as the rotary encoder, the display or the DFPlayer.
- **SmartEggApps**: Contains high-level code, which implements the actual functionality of our SmartEggTimer


## Flashing

The program code can be compiled using CMake (cf. Task_4/readme.md).

The resulting ELF file can be flashed onto our Cortex-M1 using the Raspberry Pi:

- Run jumper wires
  - between SWD and **GPIO 6** on the Raspberry Pi
  - between SWCLK and **GPIO 5** on the Raspberry Pi
  - between an arbitrary ground pin on our custom board and an arbitrary ground pin on the Raspberry Pi
- Power on our custom board
  - connect the output of the BMS board to the PWR-in header. Make sure the polarity is correct!
  - flick the switch to its "On" position
- Use `stm32f1raspberry.cfg` on the Raspberry Pi to flash the file. Run the following command on the Raspberry Pi or use a "Remote GDB Server" debug target within CLion (cf. Task_3/readme.md).

```bash
openocd -f <path to stm32f1raspberry.cfg> -c "program <path to SmartEggTimer.elf> verify" -c "reset halt"
```
