# SmartEggTimer - Software for Custom PCB

This program code is supposed to run on our custom PCB.

## Important

> The `CMakeLists.txt` file generated by CubeMX had to be modified. After regeneration of the initialisation code using CubeMX, take care not to commit any unwanted changes to `CMakeLists.txt`!


## Flashing

The program code can be compiled using CMake (cf. Task_4/readme.md).

The resulting ELF file can be flashed onto our Cortex-M1 using the Raspberry Pi:

- Run jumper wires
  - between SWD and **GPIO 6** on the Raspberry Pi
  - between SWCLK and **GPIO 5** on the Raspberry Pi
  - between an arbitrary ground pin on our custom board and an arbitrary ground pin on the Raspberry Pi
- Power on our custom board
  - connect the output of the BMS board to the PWR-in header. Make sure the polarity is correct!
  - flick the switch to its "On" position
- Use `stm32f1raspberry.cfg` on the Raspberry Pi to flash the file. Run the following command on the Raspberry Pi or use a "Remote GDB Server" debug target within CLion (cf. Task_3/readme.md).

```bash
openocd -f <path to stm32f1raspberry.cfg> -c "program <path to SmartEggTimer.elf> verify" -c "reset halt"
```
